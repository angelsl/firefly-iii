import{a as x,g as E,d as D}from"./dates-CQC-EuuA.js";import{i as m,f as _}from"./vendor-BN1MWPzx.js";import{f as L}from"./format-money-C9cJykQv.js";import{a as K,s as f,G as T}from"./show-internals-button-CY59UO3y.js";function U(){document.querySelector(".toggle-page-wizard").classList.remove("d-none")}class F{put(e,i){return x.put("/api/v2/accounts/"+e,i)}}class V{renderUrl(e,i,n){return`<a href="${e}" title="${i}">${n}</a>`}}class N{renderField(e,i){if(e==="name")return this.renderName(i)}renderName(e){return new V().renderUrl("./accounts/show/"+e.id.toString(),e.name,e.name)}}function S(t){let e=Promise.resolve(),i=[];for(let n=0;n<t.length;n++){let u=t[n],l=u.name,r=u.default;e=e.then(()=>E(l,r).then(s=>(i.push(s),Promise.resolve(i))))}return e}function M(t,e,i){function n(b,A){return b===A?'<li class="page-item active" aria-current="page"><a class="page-link" href="#" @click.prevent="goToPage('+b+')">'+b+"</a></li>":'<li class="page-item"><a class="page-link" href="#"  @click.prevent="goToPage('+b+')">'+b+"</a></li>"}let u=e||1,l=5,r=u,s=1,d=u,o=l+1,a=l+1,h="",c="",p=1,v="";for(;;)if(o>=a?(h+=n(s,e),s+=p,o--):(c=n(d,e)+c,r=d,d-=p,a--),a===0&&(p*=25,s+=p-1,s-=s%p,d-=d%p,o=l,a=l),s>d){if(v+=h+c,r>u||u>=t)break;r=t,s=u+1,d=t,o=l,a=l+1,h="",c="",p=1}return v}function j(t,e,i){t=parseInt(t),e=parseInt(e);let n='<nav aria-label="Page navigation">';return n+='<ul class="pagination">',e>1&&(n+='<li class="page-item"><a class="page-link" href="#">Previous</a></li>'),e===1&&(n+='<li class="page-item disabled"><a class="page-link">Previous</a></li>'),n+=M(t,e),e!==t&&(n+='<li class="page-item"><a class="page-link" href="#">Next</a></li>'),e===t&&(n+='<li class="page-item disabled"><a class="page-link">Next</a></li>'),n+="</ul></nav>",n}const R=window.location.href.split("?"),P=R[0].split("/"),g=P[P.length-1];let y="",w="",I=1;const k=new Proxy(new URLSearchParams(window.location.search),{get:(t,e)=>t.get(e)});y=k.column??"";w="asc";y[0]==="-"&&(y=y.substring(1),w="desc");I=parseInt(k.page??1);K();U();let B=function(){return{notifications:{error:{show:!1,text:"",url:""},success:{show:!1,text:"",url:""},wait:{show:!1,text:""}},totalPages:1,page:1,pageUrl:"",filters:{active:null,name:null,type:g},pageOptions:{isLoading:!0,groupedAccounts:!0,sortingColumn:y,sortDirection:w},tableColumns:{drag_and_drop:{visible:!0,enabled:!0},active:{visible:!0,enabled:!0},name:{visible:!0,enabled:!0},type:{visible:g==="asset",enabled:!0},liability_type:{visible:g==="liabilities",enabled:!0},liability_direction:{visible:g==="liabilities",enabled:!0},liability_interest:{visible:g==="liabilities",enabled:!0},number:{visible:!0,enabled:!0},current_balance:{visible:g!=="liabilities",enabled:!0},amount_due:{visible:g==="liabilities",enabled:!0},last_activity:{visible:!0,enabled:!0},balance_difference:{visible:!0,enabled:!0},menu:{visible:!0,enabled:!0}},editors:{},accounts:[],lastClickedFilter:"",lastFilterInput:"",goToPage(t){this.page=t,this.loadAccounts()},applyFilter(){this.filters[this.lastClickedFilter]=this.lastFilterInput,this.page=1,f(this.getPreferenceKey("filters"),this.filters),window.bootstrap.Modal.getInstance(document.getElementById("filterModal")).hide(),this.loadAccounts()},saveGroupedAccounts(){f(this.getPreferenceKey("grouped"),this.pageOptions.groupedAccounts),this.page=1,this.loadAccounts()},removeFilter(t){this.filters[t]=null,this.page=1,f(this.getPreferenceKey("filters"),this.filters),this.loadAccounts()},hasFilters(){return this.filters.name!==null},showFilterDialog(t){this.lastFilterInput=this.filters[t]??"",this.lastClickedFilter=t,document.getElementById("filterInput").focus()},accountRole(t){return m.t("firefly.account_role_"+t)},getPreferenceKey(t){return"acc_index_"+g+"_"+t},pageNavigation(){return j(this.totalPages,this.page,this.generatePageUrl(!1))},sort(t){return this.page=1,this.pageOptions.sortingColumn=t,this.pageOptions.sortDirection=this.pageOptions.sortDirection==="asc"?"desc":"asc",this.updatePageUrl(),f(this.getPreferenceKey("sc"),this.pageOptions.sortingColumn),f(this.getPreferenceKey("sd"),this.pageOptions.sortDirection),this.loadAccounts(),!1},updatePageUrl(){this.pageUrl=this.generatePageUrl(!0),window.history.pushState({},"",this.pageUrl)},generatePageUrl(t){let e="./accounts/"+g+"?column="+this.pageOptions.sortingColumn+"&direction="+this.pageOptions.sortDirection+"&page=";return t?e+this.page:e},formatMoney(t,e){return L(t,e)},format(t){return _(t,m.t("config.date_time_fns"))},saveColumnSettings(){let t={};for(let e in this.tableColumns)this.tableColumns.hasOwnProperty(e)&&(t[e]=this.tableColumns[e].enabled);console.log("New settings",t),f(this.getPreferenceKey("columns"),t)},init(){document.getElementById("filterModal").addEventListener("shown.bs.modal",e=>{document.getElementById("filterInput").focus()}),this.pageOptions.isLoading=!0,this.notifications.wait.show=!0,this.page=I,this.notifications.wait.text=m.t("firefly.wait_loading_data"),S([{name:this.getPreferenceKey("columns"),default:{drag_and_drop:!1}},{name:this.getPreferenceKey("sc"),default:""},{name:this.getPreferenceKey("sd"),default:""},{name:this.getPreferenceKey("filters"),default:this.filters},{name:this.getPreferenceKey("grouped"),default:!0}]).then(e=>{for(let i in e[0])e[0].hasOwnProperty(i)&&this.tableColumns.hasOwnProperty(i)&&(this.tableColumns[i].enabled=e[0][i]??!0);this.pageOptions.sortingColumn=this.pageOptions.sortingColumn===""?e[1]:this.pageOptions.sortingColumn,this.pageOptions.sortDirection=this.pageOptions.sortDirection===""?e[2]:this.pageOptions.sortDirection;for(let i in e[3])e[3].hasOwnProperty(i)&&this.filters.hasOwnProperty(i)&&(this.filters[i]=e[3][i]);this.pageOptions.groupedAccounts=e[4],this.loadAccounts()})},saveActiveFilter(t){this.page=1,t.currentTarget.value==="both"&&(this.filters.active=null),t.currentTarget.value==="active"&&(this.filters.active=!0),t.currentTarget.value==="inactive"&&(this.filters.active=!1),f(this.getPreferenceKey("filters"),this.filters),this.loadAccounts()},renderObjectValue(t,e){let i=new N;if(t==="name")return i.renderName(e)},submitInlineEdit(t){t.preventDefault();const e=t.currentTarget,i=e.dataset.index,n=e.dataset.field,u=e.dataset.id;console.log("Clicked edit button for account on index #"+i+" and field "+n);const l='input[data-field="'+n+'"][data-index="'+i+'"]';console.log(l);const r=document.querySelectorAll(l)[0].value??"";if(r==="")return;console.log("new field name is "+n+"="+r+" for account #"+e.dataset.id);const s={};s[n]=r,new F().put(u,s),this.accounts[i][n]=r,this.accounts[i].nameEditorVisible=!1},cancelInlineEdit(t){const i=t.currentTarget.dataset.index;this.accounts[i].nameEditorVisible=!1},triggerEdit(t){const e=t.currentTarget,i=e.dataset.index,n=e.dataset.id;console.log("Index of this row is "+i+" and ID is "+n),this.accounts[i].nameEditorVisible=!0},loadAccounts(){this.pageOptions.isLoading=!0;let t=this.pageOptions.sortingColumn;this.pageOptions.sortDirection==="asc"&&t!==""&&(t="-"+t);let e={};for(let s in this.filters)this.filters.hasOwnProperty(s)&&this.filters[s]!==null&&(e[s]=this.filters[s]);const i=new Date(window.store.get("start")),n=new Date(window.store.get("end"));let l={sort:t,filter:e,currentMoment:new Date,page:{number:this.page},startPeriod:i,endPeriod:n};this.tableColumns.balance_difference.enabled||(delete l.startPeriod,delete l.enPeriod),this.accounts=[];let r={};new T().index(l).then(s=>{console.log(s),this.totalPages=s.meta.lastPage;for(let o=0;o<s.data.length;o++)if(s.data.hasOwnProperty(o)){let a=s.data[o],h={id:parseInt(a.id),active:a.attributes.active,name:a.attributes.name,nameEditorVisible:!1,type:a.attributes.type,role:a.attributes.account_role,iban:a.attributes.iban===null?"":a.attributes.iban.match(/.{1,4}/g).join(" "),account_number:a.attributes.account_number===null?"":a.attributes.account_number,current_balance:a.attributes.current_balance,currency_code:a.attributes.currency_code,last_activity:a.attributes.last_activity===null?"":_(new Date(a.attributes.last_activity),m.t("config.month_and_day_fns")),liability_type:a.attributes.liability_type,liability_direction:a.attributes.liability_direction,interest:a.attributes.interest,interest_period:a.attributes.interest_period,balance:a.attributes.balance,native_balance:a.attributes.native_balance},c=a.attributes.object_group_id;this.pageOptions.groupedAccounts||(c="0"),r.hasOwnProperty(c)||(r[c]={group:{id:c==="0"||c===null?null:parseInt(c),title:a.attributes.object_group_title,order:a.attributes.object_group_order},accounts:[]}),r[c].accounts.push(h)}let d=[];for(let o in r)d.push(r[o]);d.sort(function(o,a){return o.group.order-a.group.order}),this.accounts=d,this.notifications.wait.show=!1,this.pageOptions.isLoading=!1})}}},O={index:B,dates:D};function C(){Object.keys(O).forEach(t=>{console.log(`Loading page component "${t}"`);let e=O[t]();Alpine.data(t,()=>e)}),Alpine.magic("t",t=>(e,i)=>m.t(e,i)),Alpine.start()}document.addEventListener("firefly-iii-bootstrapped",()=>{console.log("Loaded through event listener."),C()});window.bootstrapped&&(console.log("Loaded through window variable."),C());
